.linter_template:
  stage: Linter
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event" || $CI_PIPELINE_SOURCE == "push"'
#    changes:
#      - '**/*.py'
  tags:
    - gitlab-org

Pylint:
  allow_failure: true
  extends: .linter_template
  script:
    - >
      mkdir ./pylint;
      touch __init__.py;
      pylint --rcfile=pylintrc $PWD | tee ./pylint/pylint.log || pylint-exit $?;
      rm __init__.py
  after_script:
    - PYLINT_SCORE=$(sed -n 's/^Your code has been rated at \([-0-9.]*\)\/.*/\1/p' ./pylint/pylint.log)
    - echo ${PYLINT_SCORE}
    - echo $PYLINT_SCORE > ./pylint/score.log
  artifacts:
    when: always
    paths:
      - ./pylint/

Quality Control:
  allow_failure: false
  stage: Merge Request
  rules:
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
  script:
    - python3 quality_control.py
  tags:
    - gitlab-org
