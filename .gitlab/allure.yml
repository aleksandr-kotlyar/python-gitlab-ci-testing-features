allure:
  stage: upload-allure-reports
  image: registry.gitlab.com/aleksandr-kotlyar/python_and_gitlab/java-allure:openjdk-14-allure-2.13.6
  when: always
  script:
    - allure generate reports
  artifacts:
    paths:
      - allure-report

pages:
  image: python:3.7-alpine
  stage: deploy
  when: always
#  before_script:
#    - apk add curl unzip
#    - 'curl
#      --output artifacts.zip
#      --header "PRIVATE-TOKEN: $CI_JOB_TOKEN"
#      "https://gitlab.com/api/v4/projects/${CI_PROJECT_ID}/jobs/artifacts/${CI_COMMIT_REF_NAME}/download?job=pages"'
#    - pwd
#    - ls -la
#    - unzip artifacts.zip
  script:
    - mkdir -p .public/stage/${CI_PIPELINE_ID}
    - mv .public/* public/
    - cp -r allure-report/* ./public/stage/${CI_PIPELINE_ID}/
    - python3 generate-index.py
  artifacts:
    paths:
      - public