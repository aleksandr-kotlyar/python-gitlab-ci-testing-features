allure:
  stage: Generate Reports
  image: registry.gitlab.com/aleksandr-kotlyar/python_and_gitlab/java-allure-python:openjdk-14-allure-2.13.6-python-3.7
  when: always
  needs:
    - job: chrome:remote
      artifacts: true
  before_script:
    - python3 artifacts.py
    - ls -la
    - unzip artifacts.zip
    - ls -la
    # copy last-reports/history to /reports
  script:
    - allure generate reports
  artifacts:
    paths:
      - allure-report

pages:
  image: python:3.7-alpine
  stage: deploy
  when: on_success
  needs:
    - job: allure
      artifacts: true
  script:
    - mkdir -p .public/stage/${CI_PIPELINE_ID}
    - mv .public/* public/
    - cp -r allure-report/* ./public/stage/${CI_PIPELINE_ID}/
    - python3 generate-index.py
  artifacts:
    paths:
      - public
